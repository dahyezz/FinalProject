<?xml version="1.0" encoding="UTF-8"?>

<!-- 마이바티스 3 Mapper DOCTYPE -->
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="web.dao.face.UsedDao">

	<select id="selectCntAll"
	    resultType="int">
	    SELECT count(*)
	    FROM UsedBoard_KG
	</select>
	
	<select id="selectAll"
	    resultType="web.dto.UsedBoard"
	    parameterType="web.util.Paging">
	    SELECT 
	    	boardno, tag, title, product,
		    content, writer, hit, price,
		    writtendate
	    FROM (
	    	SELECT rownum rnum, B.* FROM (
	    	    SELECT * FROM UsedBoard_KG
	    	    ORDER BY boardno DESC
	    	    ) B
	    	ORDER BY rnum
	    ) UsedBoard_KG
	    WHERE 
	         rnum BETWEEN #{startNo } AND #{endNo }
	</select>
	
	<update id="updateHit"
	    parameterType="web.dto.UsedBoard">
	    UPDATE UsedBoard_KG
	    SET hit = hit + 1
	    WHERE boardno = #{boardno }
	</update>
	
	<select id="selectBoardByBoardno"
	    parameterType="web.dto.UsedBoard"
	    resultType="web.dto.UsedBoard">
		SELECT  
		    boardno, tag, title, product, 
		    content, writer, hit, 
		    price, writtendate
		FROM 
		    UsedBoard_KG
		WHERE 
		    boardno = #{boardno }
	</select>
	
	<insert id="write"
	    parameterType="web.dto.UsedBoard">
	    INSERT INTO USEDBOARD_KG(
	        boardno, tag, title,
	        product, content, writer,
	        hit, price, writtendate)
	        VALUES(usedboard_kg_seq, #{tag },
	        #{title }, #{product }, #{content },
	        #{writer }, #{hit }, #{price },
	        #{writtendate })
	</insert>
	
	<select id="selectBoardno"
	    resultType="int">
	    SELECT usedboard_kg_seq.nextval FROM dual
	</select>
	
	<insert id="insertBoard"
	    parameterType="web.dto.UsedBoard">
	    INSERT INTO usedboard_kg(boardno, tag, ,title,
	        product, content, writer, price)
	    VALUES (#{boardno }, #{tag }, #{title },
	        #{product }, #{content }, #{writer }, #{price })
	</insert>
	
	<insert id="insertImg"
		parameterType="web.dto.UsedBoard">
		INSERT INTO usedimg_kg(usedimgno, boardno,
			originname, storedname)
		VALUES(usedimg_kg_seq.nextval, #{boardno },
			#{originname }, #{storedname })
	</insert>
	
	<select id="selectImgByBoardno">
		SELECT * FROM usedboard_kg
		WHERE boardno = #{boardno }
	</select>
	
	<select id="selectImgByImgno">
		SELECT * FROM usedboard_kg
		WHERE usedimgno = #{usedimgno }
	</select>


</mapper>